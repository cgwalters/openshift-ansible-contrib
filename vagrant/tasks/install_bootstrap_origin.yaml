---
- name: Detecting Operating System
  stat:
    path: /run/ostree-booted
  register: ostree_booted

- copy: src=epel.repo dest=/etc/yum.repos.d/
- copy: src=RPM-GPG-KEY-EPEL-7 dest=/etc/pki/rpm-gpg/

- package:
    name: "{{ item }}"
    state: present
  with_items:
   - git
   - ansible
   - pyOpenSSL
  when: not ostree_booted.stat.exists
- command: rpm -q fuse-sshfs || rpm-ostree install fuse-sshfs git ansible pyOpenSSL
  # For now, since ansible's `pkg` module doesn't know about rpm-ostree
  when: ostree_booted.stat.exists


# TODO: merge these when atomichost branch is merged
- git:
    repo: https://github.com/openshift/openshift-ansible
    dest: ~/openshift-ansible
    force: yes
    update: yes
  become: yes
  become_user: vagrant
  when: not ostree_booted.stat.exists
- git:
    repo: https://github.com/cgwalters/openshift-ansible
    version: atomichost
    dest: ~/openshift-ansible
    force: yes
    update: yes
  become: yes
  become_user: vagrant
  when: ostree_booted.stat.exists
